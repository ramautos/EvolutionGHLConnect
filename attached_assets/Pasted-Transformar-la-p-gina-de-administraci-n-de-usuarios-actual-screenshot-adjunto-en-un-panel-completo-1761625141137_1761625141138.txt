Transformar la página de administración de usuarios actual (screenshot adjunto) en un panel completo de administración empresarial con gestión de facturación Stripe.

══════════════════════════════════════════════════════════

CONTEXTO ACTUAL:
La página muestra una tabla simple con usuarios (Nombre, Email, Teléfono, Rol, Subcuentas, Acciones).

OBJETIVO:
Crear un panel de administración completo con:
- Vista jerárquica de empresas → subcuentas → usuarios
- Sistema de facturación integrado con Stripe
- Gestión de pagos y suscripciones
- Edición de datos de clientes
- Reportes financieros

══════════════════════════════════════════════════════════

ESTRUCTURA DEL PANEL DE ADMINISTRACIÓN:

══════════════════════════════════════════════════════════

SECCIÓN 1: SIDEBAR DE NAVEGACIÓN (Nuevo)

Agregar sidebar izquierdo con menú:

📊 Dashboard
- Overview general
- Métricas rápidas

👥 Gestión de Empresas
- Todas las empresas
- Empresas activas
- Empresas en trial
- Empresas vencidas

💳 Facturación
- Todas las facturas
- Facturas pendientes
- Facturas pagadas
- Facturas vencidas
- Pagos recibidos

📈 Reportes
- Ingresos por mes
- Análisis de planes
- Tasa de conversión
- Churn rate

⚙️ Configuración
- Planes y precios
- Configuración Stripe
- Webhooks
- Notificaciones

══════════════════════════════════════════════════════════

SECCIÓN 2: VISTA PRINCIPAL - GESTIÓN DE EMPRESAS

Reemplazar la tabla simple actual por un sistema de tabs:

TAB 1: "Todas las Empresas"
TAB 2: "Activas"
TAB 3: "En Trial"
TAB 4: "Vencidas"
TAB 5: "Canceladas"

══════════════════════════════════════════════════════════

ESTRUCTURA DE LA TABLA DE EMPRESAS (Expandible):

Header superior con:
- Buscador avanzado
- Filtros: Plan, Estado, Fecha registro
- Botón: "+ Nueva Empresa"
- Exportar a CSV/Excel

Tabla principal con columnas:

[▼] | Empresa | Email Principal | Plan | Estado | Subcuentas | MRR | Próximo Cobro | Acciones

Diseño expandible (accordion):

Fila colapsada (vista inicial):
┌─────────────────────────────────────────────────────────────────────────────┐
│ [▼] │ Empresa XYZ │ admin@xyz.com │ Pro ($50) │ 🟢 Activo │ 3 │ $50 │ 15 Nov │ [...] │
└─────────────────────────────────────────────────────────────────────────────┘

Al hacer clic en [▼], expandir mostrando:

┌─────────────────────────────────────────────────────────────────────────────┐
│ [▲] │ Empresa XYZ │ admin@xyz.com │ Pro ($50) │ 🟢 Activo │ 3 │ $50 │ 15 Nov │ [...] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   📋 INFORMACIÓN DE LA EMPRESA                                              │
│   ┌──────────────────────────────────────────────────────────────┐         │
│   │ Nombre: Empresa XYZ                                           │         │
│   │ Email: admin@xyz.com                                          │         │
│   │ Teléfono: +1 (809) 497-3030                                   │         │
│   │ Fecha registro: 15 Oct 2025                                   │         │
│   │ País: República Dominicana                                    │         │
│   │ [Editar Datos] [Ver Historial]                                │         │
│   └──────────────────────────────────────────────────────────────┘         │
│                                                                              │
│   💳 FACTURACIÓN                                                            │
│   ┌──────────────────────────────────────────────────────────────┐         │
│   │ Plan actual: Pro ($50/mes)                                    │         │
│   │ Estado: Activo                                                │         │
│   │ Método de pago: •••• 4242 (Visa)                              │         │
│   │ Próximo cobro: 15 Nov 2025                                    │         │
│   │ MRR: $50                                                       │         │
│   │ Total pagado: $450                                            │         │
│   │ Stripe Customer ID: cus_xxxxxxxxxxxxx                         │         │
│   │ [Cambiar Plan] [Ver Facturas] [Gestionar Pago]                │         │
│   └──────────────────────────────────────────────────────────────┘         │
│                                                                              │
│   🏢 SUBCUENTAS (3)                                                         │
│   ┌──────────────────────────────────────────────────────────────┐         │
│   │                                                                │         │
│   │  1. Subcuenta Ventas (TEST_LOC_001)                           │         │
│   │     └─ Email: ventas@xyz.com                                  │         │
│   │     └─ Trial: 5 días restantes                                │         │
│   │     └─ Instancias: 2/5                                        │         │
│   │     └─ [Ver Detalles] [Editar] [Suspender]                    │         │
│   │                                                                │         │
│   │  2. Subcuenta Marketing (TEST_LOC_002)                        │         │
│   │     └─ Email: marketing@xyz.com                               │         │
│   │     └─ Plan: Básico ($30)                                     │         │
│   │     └─ Instancias: 1/1                                        │         │
│   │     └─ [Ver Detalles] [Editar] [Suspender]                    │         │
│   │                                                                │         │
│   │  3. Subcuenta Soporte (TEST_LOC_003)                          │         │
│   │     └─ Email: soporte@xyz.com                                 │         │
│   │     └─ Plan: Pro ($50)                                        │         │
│   │     └─ Instancias: 4/5                                        │         │
│   │     └─ [Ver Detalles] [Editar] [Suspender]                    │         │
│   │                                                                │         │
│   │  [+ Agregar Subcuenta]                                        │         │
│   └──────────────────────────────────────────────────────────────┘         │
│                                                                              │
│   👥 USUARIOS (5)                                                           │
│   ┌──────────────────────────────────────────────────────────────┐         │
│   │ Nombre          │ Email              │ Rol     │ Subcuenta   │         │
│   ├─────────────────┼────────────────────┼─────────┼─────────────┤         │
│   │ José Admin      │ jose@xyz.com       │ 🔵 admin│ Principal   │         │
│   │ María Sales     │ maria@xyz.com      │ 👤 user │ Ventas      │         │
│   │ Carlos Mkt      │ carlos@xyz.com     │ 👤 user │ Marketing   │         │
│   │ Ana Support     │ ana@xyz.com        │ 👤 user │ Soporte     │         │
│   │ Luis Manager    │ luis@xyz.com       │ 🟡 manager│ Ventas    │         │
│   └──────────────────────────────────────────────────────────────┘         │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 3: MODAL DE EDICIÓN DE EMPRESA

Al hacer clic en "Editar Datos", abrir modal:

┌────────────────────────────────────────────────────────┐
│  ✏️ Editar Empresa XYZ                         [X]      │
├────────────────────────────────────────────────────────┤
│                                                         │
│  INFORMACIÓN GENERAL                                    │
│  ┌─────────────────────────────────────────┐          │
│  │ Nombre de la empresa *                  │          │
│  │ [Empresa XYZ                           ]│          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  ┌─────────────────────────────────────────┐          │
│  │ Email principal *                       │          │
│  │ [admin@xyz.com                         ]│          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  ┌─────────────────────────────────────────┐          │
│  │ Teléfono                                │          │
│  │ [+1 (809) 497-3030                     ]│          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  ┌─────────────────────────────────────────┐          │
│  │ País                                    │          │
│  │ [República Dominicana            ▼]    │          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  ┌─────────────────────────────────────────┐          │
│  │ Dirección                               │          │
│  │ [Calle Principal #123                  ]│          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  NOTAS INTERNAS                                        │
│  ┌─────────────────────────────────────────┐          │
│  │                                          │          │
│  │ Cliente importante, contactar           │          │
│  │ mensualmente para feedback...            │          │
│  │                                          │          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  [Cancelar]              [Guardar Cambios]             │
│                                                         │
└────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 4: GESTIÓN DE FACTURACIÓN

Crear página completa de facturación con tabs:

TAB 1: "Todas las Facturas"
TAB 2: "Pendientes"
TAB 3: "Pagadas"
TAB 4: "Vencidas"
TAB 5: "Reembolsos"

Header con:
- Rango de fechas (datepicker)
- Filtros: Empresa, Plan, Estado
- Búsqueda por número de factura
- Botón: "Crear Factura Manual"
- Exportar: PDF, CSV, Excel

Tabla de facturas:

┌─────────────────────────────────────────────────────────────────────────────────────┐
│ # Factura │ Empresa │ Concepto │ Fecha │ Vencimiento │ Monto │ Estado │ Acciones   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ INV-001   │ XYZ     │ Plan Pro │ 15 Oct│ 15 Nov      │ $50   │ 🟢 Pagada│ [Ver][⬇] │
│ INV-002   │ ABC     │ Básico   │ 12 Oct│ 12 Nov      │ $30   │ 🟡 Pend. │ [Ver][⬇] │
│ INV-003   │ DEF     │ Pro+Add  │ 10 Oct│ 10 Nov      │ $65   │ 🔴 Venc. │ [Ver][⬇] │
└─────────────────────────────────────────────────────────────────────────────────────┘

Al hacer clic en "Ver", modal de detalle:

┌────────────────────────────────────────────────────────┐
│  📄 Factura INV-001                            [X]     │
├────────────────────────────────────────────────────────┤
│                                                         │
│  INFORMACIÓN DE LA FACTURA                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Número: INV-001                                       │
│  Fecha emisión: 15 Oct 2025                            │
│  Fecha vencimiento: 15 Nov 2025                        │
│  Estado: 🟢 Pagada el 15 Oct 2025                      │
│                                                         │
│  CLIENTE                                               │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Empresa XYZ                                           │
│  admin@xyz.com                                         │
│  +1 (809) 497-3030                                     │
│                                                         │
│  DETALLES DE COBRO                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Plan Pro (5 agentes)                    $50.00       │
│  Impuestos (0%)                          $0.00        │
│  ─────────────────────────────────────────────        │
│  Total                                   $50.00       │
│                                                         │
│  INFORMACIÓN DE PAGO                                   │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Método: Visa •••• 4242                                │
│  Stripe Payment ID: pi_xxxxxxxxxxxxx                   │
│  Stripe Invoice ID: in_xxxxxxxxxxxxx                   │
│  Procesado: 15 Oct 2025 10:30 AM                       │
│                                                         │
│  [Descargar PDF] [Enviar por Email] [Reembolsar]      │
│                                                         │
└────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 5: DASHBOARD DE MÉTRICAS

Crear página de Dashboard con widgets:

┌─────────────────────────────────────────────────────────┐
│                     DASHBOARD                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  MÉTRICAS DEL MES                                       │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │
│  │ 💰 MRR   │ │ 🏢 Clien.│ │ 📊 Conv. │ │ 🔄 Churn │  │
│  │          │ │          │ │          │ │          │  │
│  │ $12,450  │ │   245    │ │   15%    │ │   3.2%   │  │
│  │ +12% ↗   │ │   +18    │ │  +2.1%   │ │  -0.5%   │  │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │
│                                                          │
│  INGRESOS POR MES (Últimos 6 meses)                     │
│  ┌────────────────────────────────────────────────┐    │
│  │  Gráfico de barras/líneas                      │    │
│  │  Jun    Jul    Ago    Sep    Oct    Nov       │    │
│  │   █      █      █      █      █      █        │    │
│  │  $8K   $9K   $10K   $11K   $12K   $13K        │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
│  DISTRIBUCIÓN POR PLAN                                  │
│  ┌────────────────────────────────────────────────┐    │
│  │  Gráfico circular (donut chart)                │    │
│  │  - Starter: 30% (72 clientes)                  │    │
│  │  - Básico: 45% (110 clientes)                  │    │
│  │  - Pro: 20% (49 clientes)                      │    │
│  │  - Enterprise: 5% (12 clientes)                │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
│  ÚLTIMOS PAGOS RECIBIDOS                                │
│  ┌────────────────────────────────────────────────┐    │
│  │ Empresa XYZ    $50.00    15 Oct   🟢 Exitoso  │    │
│  │ Empresa ABC    $30.00    14 Oct   🟢 Exitoso  │    │
│  │ Empresa DEF    $65.00    13 Oct   🔴 Fallido  │    │
│  │ [Ver todos los pagos →]                        │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
│  ALERTAS Y NOTIFICACIONES                               │
│  ┌────────────────────────────────────────────────┐    │
│  │ ⚠️  5 trials expiran en las próximas 48h      │    │
│  │ 🔴 3 pagos fallidos requieren atención         │    │
│  │ 🟡 12 facturas vencen esta semana              │    │
│  │ [Ver todas las alertas →]                      │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
└─────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 6: GESTIÓN DE PAGOS

Crear sección específica para pagos con tabs:

TAB 1: "Todos los Pagos"
TAB 2: "Exitosos"
TAB 3: "Fallidos"
TAB 4: "Pendientes"
TAB 5: "Reembolsos"

Tabla de pagos:

┌─────────────────────────────────────────────────────────────────────────────────┐
│ Fecha │ Empresa │ Monto │ Método │ Estado │ Stripe ID │ Factura │ Acciones     │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 15 Oct│ XYZ     │ $50   │ Visa ••42│ 🟢 Exitoso│ pi_xxx │ INV-001│ [Ver][Reemb]│
│ 14 Oct│ ABC     │ $30   │ MC ••88  │ 🟢 Exitoso│ pi_yyy │ INV-002│ [Ver][Reemb]│
│ 13 Oct│ DEF     │ $65   │ Visa ••12│ 🔴 Fallido│ pi_zzz │ INV-003│ [Ver][Reintentar]│
└─────────────────────────────────────────────────────────────────────────────────┘

Botones de acción:
- "Reintentar Pago" (para pagos fallidos)
- "Procesar Reembolso"
- "Descargar Recibo"
- "Enviar Confirmación por Email"

══════════════════════════════════════════════════════════

SECCIÓN 7: GESTIÓN DE MÉTODOS DE PAGO

Modal para gestionar tarjetas del cliente:

┌────────────────────────────────────────────────────────┐
│  💳 Métodos de Pago - Empresa XYZ          [X]         │
├────────────────────────────────────────────────────────┤
│                                                         │
│  TARJETAS GUARDADAS                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│                                                         │
│  ✓ Principal                                           │
│  ┌─────────────────────────────────────────┐          │
│  │ 💳 Visa •••• 4242                       │          │
│  │ Expira: 12/2027                         │          │
│  │ [Establecer como principal] [Eliminar]  │          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  ┌─────────────────────────────────────────┐          │
│  │ 💳 Mastercard •••• 8888                 │          │
│  │ Expira: 08/2026                         │          │
│  │ [Establecer como principal] [Eliminar]  │          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  [+ Agregar Nueva Tarjeta]                             │
│                                                         │
│  HISTORIAL DE CAMBIOS                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  • Tarjeta ••42 agregada - 15 Oct 2025                │
│  • Tarjeta ••88 agregada - 10 Sep 2025                │
│                                                         │
│  [Cerrar]                                              │
│                                                         │
└────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 8: CAMBIO DE PLAN

Modal para cambiar plan de una subcuenta:

┌────────────────────────────────────────────────────────┐
│  🔄 Cambiar Plan - Subcuenta Ventas        [X]         │
├────────────────────────────────────────────────────────┤
│                                                         │
│  PLAN ACTUAL                                           │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Trial (5 días restantes)                              │
│  • Instancias ilimitadas                               │
│  • Expira: 20 Oct 2025                                 │
│                                                         │
│  SELECCIONAR NUEVO PLAN                                │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│                                                         │
│  ○ Starter - $10/mes                                   │
│     └─ 1 agente, calendario, etiquetas                 │
│                                                         │
│  ● Básico - $30/mes  (RECOMENDADO)                     │
│     └─ 1 agente, todos los CRMs, imágenes, audio       │
│                                                         │
│  ○ Pro - $50/mes                                       │
│     └─ 1 agente, BD custom, ElevenLabs, emails         │
│                                                         │
│  ○ Enterprise - A medida                               │
│     └─ 100% personalizable                             │
│                                                         │
│  RESUMEN                                               │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Nuevo plan: Básico                                    │
│  Costo mensual: $30.00                                 │
│  Proration: -$5.00 (crédito por días restantes)        │
│  Cargo hoy: $25.00                                     │
│  Próximo cobro: 15 Nov 2025 ($30.00)                   │
│                                                         │
│  ☐ Aplicar cambio inmediatamente                       │
│  ☐ Aplicar al final del periodo actual                 │
│                                                         │
│  [Cancelar]              [Confirmar Cambio]            │
│                                                         │
└────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 9: REPORTES FINANCIEROS

Crear página de reportes con:

SELECTOR DE REPORTE:
- Ingresos por mes
- Ingresos por plan
- Ingresos por subcuenta
- Análisis de churn
- Proyección de ingresos
- Customer Lifetime Value
- Tasa de conversión trial → pago

FILTROS:
- Rango de fechas
- Plan específico
- Estado (activo, trial, cancelado)
- País/región

VISUALIZACIÓN:
- Gráficos interactivos (Chart.js o Recharts)
- Tablas exportables
- KPIs destacados
- Comparativas mes vs mes

Ejemplo de reporte "Ingresos por mes":

┌─────────────────────────────────────────────────────────┐
│  📊 REPORTE: INGRESOS POR MES                          │
│  Periodo: Últimos 6 meses                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  KPIs PRINCIPALES                                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐              │
│  │ Total    │ │ Promedio │ │ Crecimiento│             │
│  │ $74,500  │ │ $12,417  │ │   +15.8%  │             │
│  └──────────┘ └──────────┘ └──────────┘              │
│                                                         │
│  GRÁFICO DE INGRESOS                                   │
│  [Gráfico de barras con tendencia]                     │
│                                                         │
│  DESGLOSE POR MES                                      │
│  ┌───────────────────────────────────────┐            │
│  │ Mes      │ Ingresos │ Variación │ %  │            │
│  ├───────────────────────────────────────┤            │
│  │ Junio    │ $8,200   │ -         │ -  │            │
│  │ Julio    │ $9,100   │ +$900     │+11%│            │
│  │ Agosto   │ $10,500  │ +$1,400   │+15%│            │
│  │ Septiem. │ $11,800  │ +$1,300   │+12%│            │
│  │ Octubre  │ $13,200  │ +$1,400   │+12%│            │
│  │ Noviem.  │ $14,700  │ +$1,500   │+11%│            │
│  └───────────────────────────────────────┘            │
│                                                         │
│  [Exportar PDF] [Exportar Excel] [Compartir]          │
│                                                         │
└─────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

SECCIÓN 10: CONFIGURACIÓN DE STRIPE

Página de configuración con:

┌─────────────────────────────────────────────────────────┐
│  ⚙️ CONFIGURACIÓN DE STRIPE                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  CREDENCIALES                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  Publishable Key                                       │
│  [pk_live_xxxxxxxxxxxxxxxxxxxxxxxx]                    │
│                                                         │
│  Secret Key                                            │
│  [sk_live_••••••••••••••••••••••••] [Mostrar]         │
│                                                         │
│  Webhook Secret                                        │
│  [whsec_••••••••••••••••••••••••••] [Mostrar]         │
│                                                         │
│  CONFIGURACIÓN                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  ☑ Modo producción                                     │
│  ☑ Cobros automáticos                                  │
│  ☑ Reintentos de pago (3 intentos)                     │
│  ☑ Proration al cambiar plan                           │
│  ☐ Trial por defecto (15 días)                         │
│                                                         │
│  WEBHOOKS CONFIGURADOS                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  • payment_intent.succeeded                            │
│  • payment_intent.failed                               │
│  • invoice.payment_succeeded                           │
│  • invoice.payment_failed                              │
│  • customer.subscription.created                       │
│  • customer.subscription.updated                       │
│  • customer.subscription.deleted                       │
│                                                         │
│  URL del webhook:                                      │
│  https://tuapp.com/api/webhooks/stripe                 │
│                                                         │
│  [Probar Webhook] [Ver Logs]                           │
│                                                         │
│  [Guardar Cambios]                                     │
│                                                         │
└─────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════

FUNCIONALIDADES ADICIONALES:

1. BÚSQUEDA GLOBAL
   - Barra de búsqueda en el header
   - Buscar por: empresa, email, factura, location_id
   - Resultados con quick preview

2. NOTIFICACIONES
   - Bell icon en header con badge contador
   - Dropdown con últimas notificaciones:
     * Pagos recibidos
     * Pagos fallidos
     * Trials expirando
     * Cambios de plan
     * Cancelaciones

3. ACCIONES MASIVAS
   - Checkbox para seleccionar múltiples empresas
   - Acciones: Enviar email, Suspender, Reactivar, Exportar

4. LOGS DE ACTIVIDAD
   - Tracking de cambios:
     * Quién hizo qué
     * Cuándo
     * Qué cambió (antes/después)
   - Filtrable por usuario admin, fecha, tipo de acción

5. EXPORTACIONES
   - Todos los listados exportables a CSV/Excel
   - Facturas en PDF con logo y branding
   - Reportes programados (envío automático por email)

══════════════════════════════════════════════════════════

INTEGRACIONES CON STRIPE:

EVENTOS A MANEJAR:
- payment_intent.succeeded → Marcar factura como pagada
- payment_intent.failed → Notificar y registrar fallo
- invoice.payment_succeeded → Actualizar siguiente fecha cobro
- invoice.payment_failed → Enviar alerta, crear tarea follow-up
- customer.subscription.created → Activar subcuenta
- customer.subscription.updated → Reflejar cambio de plan
- customer.subscription.deleted → Suspender servicio

FLUJO DE PAGO:
1. Usuario cambia de plan en su dashboard
2. Sistema crea/actualiza subscription en Stripe
3. Stripe procesa el pago
4. Webhook notifica resultado
5. Sistema actualiza estado en BD
6. Envío de email confirmación
7. Registro en log de actividad

══════════════════════════════════════════════════════════

DISEÑO VISUAL:

PALETA DE COLORES:
- Primary: Morado #8B5CF6 (mantener consistencia)
- Success: Verde #10B981
- Warning: Amarillo #F59E0B
- Danger: Rojo #EF4444
- Info: Azul #3B82F6
- Neutral: Grises #6B7280, #F3F4F6

ESTADOS CON COLORES:
- 🟢 Activo/Pagado: Verde
- 🟡 Pendiente/Trial: Amarillo
- 🔴 Vencido/Fallido: Rojo
- ⚫ Cancelado: Gris
- 🔵 Admin role: Azul

BADGES:
- Redondeados con padding pequeño
- Colores según estado
- Texto en mayúsculas o capitalize

TABLAS:
- Header con fondo gris claro
- Rows con hover effect
- Bordes sutiles
- Alternating rows (zebra striping opcional)

CARDS:
- Sombra suave
- Bordes redondeados 8-12px
- Padding 20-24px
- Separadores con líneas sutiles

══════════════════════════════════════════════════════════

RESPONSIVE:

MOBILE:
- Sidebar colapsable (hamburger menu)
- Tablas scroll horizontal o cards stack
- Gráficos adaptados
- Botones full-width
- Modals ocupan 100% viewport

TABLET:
- Sidebar visible pero estrecho
- Tablas con scroll horizontal
- Grid 2 columnas

DESKTOP:
- Layout completo como descrito
- Sidebar fijo de 240-280px
- Contenido principal fluid

══════════════════════════════════════════════════════════

PERMISOS Y ROLES:

SUPER ADMIN:
- Acceso total
- Ver todas las empresas
- Gestionar facturación
- Cambiar planes
- Procesar reembolsos
- Ver reportes completos
- Configurar Stripe

ADMIN:
- Ver su empresa y subcuentas
- Ver facturas propias
- Cambiar su plan
- Gestionar usuarios de su empresa
- No puede ver otras empresas

USER:
- Ver solo su subcuenta
- Ver facturas de su subcuenta
- No puede cambiar plan
- No puede gestionar usuarios

══════════════════════════════════════════════════════════

VALIDACIONES Y ALERTAS:

ANTES DE SUSPENDER:
- Confirmar acción con modal
- Advertir sobre instancias activas
- Notificar al cliente por email

ANTES DE CAMBIAR PLAN:
- Validar límites (ej: downgrade con más instancias)
- Mostrar proration
- Confirmar cargo inmediato

PAGOS FALLIDOS:
- 3 reintentos automáticos (día 1, 3, 7)
- Email de notificación al cliente
- Suspensión automática tras 3 fallos
- Alerta al admin

TRIALS EXPIRANDO:
- Notificación 7 días antes
- Notificación 3 días antes
- Notificación 1 día antes
- Suspensión automática al expirar

══════════════════════════════════════════════════════════

BASE DE DATOS (Tablas necesarias):

companies:
- id, name, email, phone, country, address
- stripe_customer_id
- created_at, updated_at

subscriptions:
- id, company_id, location_id
- plan_type, status
- stripe_subscription_id
- trial_ends_at
- current_period_start, current_period_end
- cancel_at_period_end

invoices:
- id, company_id, subscription_id
- invoice_number
- amount, tax, total
- status (paid, pending, failed, refunded)
- stripe_invoice_id
- due_date, paid_at

payments:
- id, invoice_id, company_id
- amount
- payment_method
- stripe_payment_id
- status
- created_at

payment_methods:
- id, company_id
- stripe_payment_method_id
- brand, last4
- exp_month, exp_year
- is_default

activity_logs:
- id, user_id, company_id
- action, description
- before_data, after_data (JSON)
- created_at

══════════════════════════════════════════════════════════

PRIORIDAD DE IMPLEMENTACIÓN:

FASE 1 (Core):
1. Sidebar y navegación
2. Vista expandible de empresas
3. Edición de datos de empresa
4. Vista de subcuentas

FASE 2 (Facturación):
5. Lista de facturas
6. Detalle de factura
7. Integración básica Stripe
8. Webhooks handler

FASE 3 (Pagos):
9. Gestión de pagos
10. Métodos de pago
11. Reembolsos
12. Reintentos

FASE 4 (Analytics):
13. Dashboard con métricas
14. Reportes básicos
15. Gráficos interactivos

FASE 5 (Avanzado):
16. Cambio de planes
17. Proration
18. Logs de actividad
19. Notificaciones
20. Permisos por rol

══════════════════════════════════════════════════════════