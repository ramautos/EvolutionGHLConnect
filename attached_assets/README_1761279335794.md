# WhatsApp-GHL Integration Platform

A complete multi-tenant SaaS platform for managing WhatsApp Business integrations with GoHighLevel CRM.

## Features

- **Multi-tenant Architecture**: Support for multiple companies, agencies, and locations
- **WhatsApp Integration**: Generate QR codes, manage instances, and handle WhatsApp connections
- **GoHighLevel CRM Integration**: Seamless integration with GHL for lead management
- **User Management**: Role-based access control (Super Admin, Agency, User, Reseller)
- **Impersonation**: Super admins can view the system as any user
- **Real-time Connection Detection**: Automatic polling for WhatsApp connection status
- **Responsive Design**: Mobile-friendly interface with Tailwind CSS styling

## Tech Stack

### Frontend
- React 19.2.0
- React Router v7
- Axios for API calls
- JWT Authentication
- React Hot Toast for notifications
- Tailwind CSS (via utility classes)

### Backend (Separate Repository)
- Node.js + Express
- PostgreSQL + Prisma ORM
- Evolution API for WhatsApp
- GoHighLevel API Integration
- JWT Authentication
- Google OAuth 2.0

## Project Structure

```
src/
├── components/
│   ├── auth/
│   │   └── ProtectedRoute.js       # Route protection with role checking
│   └── common/
│       ├── Button.js                # Reusable button component
│       ├── Card.js                  # Card wrapper component
│       ├── Header.js                # Page header with impersonation banner
│       ├── Modal.js                 # Modal dialog component
│       ├── StatsCard.js             # Statistics display card
│       └── Tabs.js                  # Tab navigation component
├── context/
│   └── AuthContext.js               # Global authentication state
├── pages/
│   ├── LoginPage.js                 # Login with email/password and Google OAuth
│   ├── RegisterPage.js              # User registration
│   ├── SuperAdminPage.js            # Super admin dashboard
│   ├── AgencyPage.js                # Agency/User dashboard
│   └── LocationPage.js              # Location dashboard with WhatsApp management
├── services/
│   ├── api.js                       # Axios instance with interceptors
│   ├── authService.js               # Authentication service
│   └── apiService.js                # All API endpoints organized by module
├── utils/
│   └── constants.js                 # Application constants
├── App.js                           # Main app with routing
└── index.js                         # App entry point with providers
```

## API Endpoints

The application communicates with the backend API through the following modules:

### Authentication
- `POST /api/auth/register` - Register new user
- `POST /api/auth/login` - Login with credentials
- `GET /api/auth/me` - Get current user
- `POST /api/auth/impersonate` - Impersonate user (Super Admin only)
- `GET /api/auth/google` - Google OAuth login

### Super Admin
- `GET /api/superadmin/stats` - System statistics
- `GET /api/superadmin/companies` - List all companies
- `POST /api/superadmin/companies` - Create company
- `PUT /api/superadmin/companies/:id` - Update company
- `DELETE /api/superadmin/companies/:id` - Delete company
- `GET /api/superadmin/users` - List all users
- `POST /api/superadmin/users` - Create user
- `PUT /api/superadmin/users/:id` - Update user
- `DELETE /api/superadmin/users/:id` - Delete user
- `GET /api/superadmin/audit-logs` - Audit trail

### Agency Dashboard
- `GET /api/dashboard/agency` - Agency dashboard data
- `GET /api/dashboard/locations` - List locations
- `POST /api/dashboard/locations/add` - Create location
- `DELETE /api/dashboard/locations/:id` - Delete location

### WhatsApp Instances
- `GET /api/instances/:locationId` - List instances for location
- `POST /api/instances/:locationId` - Create instance
- `PUT /api/instances/:locationId/:number` - Update instance
- `DELETE /api/instances/:locationId/:number` - Delete instance
- `POST /api/instances/:locationId/:number/qr` - Generate QR code
- `POST /api/instances/:locationId/:number/phone` - Get phone number
- `POST /api/instances/:locationId/:number/logout` - Disconnect WhatsApp

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd whatssapp
```

2. Install dependencies:
```bash
npm install
```

3. Create environment file:
```bash
cp .env.example .env
```

4. Update `.env` with your configuration:
```env
REACT_APP_API_URL=http://localhost:3000
REACT_APP_GOOGLE_CLIENT_ID=your-google-client-id
```

5. Start the development server:
```bash
npm start
```

The app will open at [http://localhost:3000](http://localhost:3000)

## Available Scripts

- `npm start` - Start development server
- `npm run build` - Build for production
- `npm test` - Run tests
- `npm run eject` - Eject from Create React App

## Authentication Flow

1. **Login**: User enters email/password or uses Google OAuth
2. **JWT Token**: Backend returns JWT token (30-day expiration)
3. **Token Storage**: Token stored in localStorage
4. **Auto-Injection**: Axios interceptor adds token to all requests
5. **Protected Routes**: Routes check authentication and role
6. **Impersonation**: Super admins can view as other users

## Key Features

### Impersonation System
Super admins can impersonate any user:
1. Admin clicks "View" button on user
2. Current admin token saved to `admin_token`
3. User's token replaces main token
4. Yellow banner shows impersonation mode
5. Click "Back to Admin Panel" to restore

### WhatsApp QR Code Flow
1. User clicks "Generate QR" on instance
2. Modal displays QR code image
3. Automatic polling starts (every 3 seconds)
4. When phone number detected, modal closes
5. Success notification shows connected number
6. Instance list refreshes with new status

### Real-time Polling
The app polls for WhatsApp connection every 3 seconds for up to 2 minutes:
```javascript
const startPhonePolling = async (number) => {
  const interval = setInterval(async () => {
    const result = await apiService.instances.getPhone(locationId, number);
    if (result.data.phoneNumber) {
      clearInterval(interval);
      toast.success(`Connected: ${result.data.phoneNumber}`);
    }
  }, 3000);
};
```

## Dashboards

### Super Admin Dashboard
- System statistics (companies, users, instances, revenue)
- Company management (create, edit, activate/suspend, delete)
- User management (create, edit, delete, impersonate)
- Audit logs for all system actions

### Agency Dashboard
- Location statistics (total, active, instances)
- Location grid with management actions
- Create new locations (sub-accounts)
- Navigate to location details

### Location Dashboard
- **WhatsApp Tab**: 
  - Instance cards with status indicators
  - Generate QR codes for connection
  - Custom name editing
  - Connect/disconnect actions
  - Delete instances
- **Settings Tab**:
  - Notification email/phone
  - Phone identification toggle

## Styling

The app uses inline Tailwind-style classes for styling:
- Purple gradient theme (`#667eea` to `#764ba2`)
- WhatsApp green for connected status (`#25d366`)
- Responsive grid layouts
- Card-based UI components
- Custom animations and transitions

## Environment Variables

Required environment variables:

```env
REACT_APP_API_URL          # Backend API URL (default: http://localhost:3000)
REACT_APP_GOOGLE_CLIENT_ID # Google OAuth Client ID (optional)
```

## Deployment

### Build for Production
```bash
npm run build
```

The `build` folder contains the optimized production build.

### Serve Static Build
```bash
npm install -g serve
serve -s build
```

### Deploy to Hosting
Upload the `build` folder to your hosting provider:
- Vercel
- Netlify
- AWS S3 + CloudFront
- Digital Ocean App Platform

## Browser Support

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is proprietary software. All rights reserved.

## Support

For support, email support@example.com or open an issue in the repository.
